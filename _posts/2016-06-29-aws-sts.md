---
layout: post
title: "AWS - STS"
description: ""
category: posts
tags: [iam, aws, aws-dev-ops-pro, aws-solutions-arch-pro]
---
{% include JB/setup %}

AWS [Security Token Service (STS)](http://docs.aws.amazon.com/STS/latest/APIReference/Welcome.html) is a web service that enables you to request temporary, limited-privilege credentials for AWS Identity and Access Management (IAM) users or for federated users.

There are several use cases for STS including Web Identity federation, Corporate ID federation and Cross account federation. The other sort of odd use case for STS is in roles assigned to EC2 instance or other AWS services on your behalf.

## Basic STS Flow

1. Develop Broker

2. Broker authenticates with LDAP THEN with AWS STS

3. App gets temp access.

## Web Identity Federation

Using the Social Identity Provider, which is an IAM object that holds configuration info about the external provider, this feature enables users to use a well-known 

After the first call from the app to STS, it returns a temporary security credential including an access key/secret key pair (just like AWS does) and a session token. The AWS STS API call `AssumeRole` requests a temporary security credential - you will want to save these credentials for the length of the session and request new ones before they expire.

## Web Identity Provider Access to DynamoDB (or other AWS Services)

This is a huge issue because many times users are authenticated by an ID provider then need access to services. In this example, to get access to DynamoDB the steps are:

1. Authenticate with ID provider (Receive Token from ID provider)

3. App calls STS with `AssumeRoleWithWebIdentity` &amp; passes in provider token and ARN for IAM role.

4. STS returns access key, secret access key, the token and a duration for a period of 15 minutes to 1 hours. 1 hour is the default.

5. The application then using the returns info to access DynamoDB by adding the session token to the HTTP header or adding it to the query string parameter `X-AMZ-Security-Token`.

### WIF Setup



## Corporate and ID Federation

AD and it's hosted version [AWS Directory Service](https://aws.amazon.com/directoryservice/), LDAP and SAML can be integrated into IAM; generally you map groups in the ID provider to IAM roles

### Corporate ID Federation Setup


## ID Broker

To make this work, you first need to develop an identity broker that communicates with LDAP and STS and in all scenarios the the broker authenticates with LDAP first then with STS

* Past that, your app gets temp access after receiving a token

OR 

* Your app can assume an IAM role to interact with an AWS resource.

